LIST        p=16F84     ; ????????? ???? ????????????????
#include <p16f84.inc>    

cblock  10h  ; ???? ???
	R1
	R2
	R3
endc

org 2100h
de 0fh ;????? ?????????
org 0
goto Start

EEPROM_WRITE
	bsf STATUS, RP0
	bsf EECON1, WREN
	bcf INTCON,GIE  ; ?????????? ?????? ??????????.
	movlw 055h        ; ????????????
	movwf EECON2      ; ?????????
	movlw 0AAh        ; ??? ??????.
	movwf EECON2      ; ----"----
	bsf   EECON1,WR    ; ----"----
	btfsc EECON1,WR ; ?????????, ??????????? ?? ??????
	goto $-1
	bsf INTCON,GIE ; ???????? ???? ?????????? ?? ????????? ?????? ? EEPROM.
	bcf EECON1,WREN   
	bcf STATUS,RP0  ; ??????? ? ??????? ????.
return

EEPROM_READ
	bsf STATUS, RP0
	bsf EECON1, RD
	bcf STATUS, RP0
return

Start
movlw 00h     ; ????????? ?? ?????? 0 ? EEPROM ???????????? ?? ????-?? ? R1
movwf EEADR
call EEPROM_READ
movf EEDATA,W
movwf R1
movlw 00h 
movwf R2 ;r2 is the cycle counter
cycle
	movf R2,0
	movwf R3
	rlf R3,1; GRAY code: XGr=(X XOR (X SHL 1)) SHR 1
	movf R3,0
	xorwf R2,0
	movwf R3
	rrf R3,0;? W ??? ???? ??? ??????? ???????? R2
	movwf EEDATA   
	incf R2
	movf R2,0      
	movwf EEADR    
	call EEPROM_WRITE
	movf R2,0
	subwf R1,0
	movwf R3
	incfsz R3,1
goto cycle

end
